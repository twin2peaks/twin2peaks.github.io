var _=Object.defineProperty;var $=(t,e,i)=>e in t?_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var u=(t,e,i)=>$(t,typeof e!="symbol"?e+"":e,i);let q=-1;const f=t=>{addEventListener("pageshow",e=>{e.persisted&&(q=e.timeStamp,t(e))},!0)},h=(t,e,i,n)=>{let r,o;return a=>{e.value>=0&&(a||n)&&(o=e.value-(r??0),(o||r===void 0)&&(r=e.value,e.delta=o,e.rating=((s,d)=>s>d[1]?"poor":s>d[0]?"needs-improvement":"good")(e.value,i),t(e)))}},E=t=>{requestAnimationFrame(()=>requestAnimationFrame(()=>t()))},R=()=>{const t=performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},T=()=>{const t=R();return(t==null?void 0:t.activationStart)??0},p=(t,e=-1)=>{const i=R();let n="navigate";return q>=0?n="back-forward-cache":i&&(document.prerendering||T()>0?n="prerender":document.wasDiscarded?n="restore":i.type&&(n=i.type.replace(/_/g,"-"))),{name:t,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:n}},P=new WeakMap;function S(t,e){return P.get(t)||P.set(t,new e),P.get(t)}class W{constructor(){u(this,"t");u(this,"i",0);u(this,"o",[])}h(e){var r;if(e.hadRecentInput)return;const i=this.o[0],n=this.o.at(-1);this.i&&i&&n&&e.startTime-n.startTime<1e3&&e.startTime-i.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),(r=this.t)==null||r.call(this,e)}}const v=(t,e,i={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const n=new PerformanceObserver(r=>{Promise.resolve().then(()=>{e(r.getEntries())})});return n.observe({type:t,buffered:!0,...i}),n}}catch{}},w=t=>{let e=!1;return()=>{e||(t(),e=!0)}};let m=-1;const B=new Set,A=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,b=t=>{if(document.visibilityState==="hidden"){if(t.type==="visibilitychange")for(const e of B)e();isFinite(m)||(m=t.type==="visibilitychange"?t.timeStamp:0,removeEventListener("prerenderingchange",b,!0))}},y=()=>{var t;if(m<0){const e=T();m=(document.prerendering||(t=globalThis.performance.getEntriesByType("visibility-state").filter(n=>n.name==="hidden"&&n.startTime>e)[0])==null?void 0:t.startTime)??A(),addEventListener("visibilitychange",b,!0),addEventListener("prerenderingchange",b,!0),f(()=>{setTimeout(()=>{m=A()})})}return{get firstHiddenTime(){return m},onHidden(e){B.add(e)}}},I=t=>{document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},M=[1800,3e3],j=(t,e={})=>{I(()=>{const i=y();let n,r=p("FCP");const o=v("paint",a=>{for(const s of a)s.name==="first-contentful-paint"&&(o.disconnect(),s.startTime<i.firstHiddenTime&&(r.value=Math.max(s.startTime-T(),0),r.entries.push(s),n(!0)))});o&&(n=h(t,r,M,e.reportAllChanges),f(a=>{r=p("FCP"),n=h(t,r,M,e.reportAllChanges),E(()=>{r.value=performance.now()-a.timeStamp,n(!0)})}))})},k=[.1,.25],U=(t,e={})=>{const i=y();j(w(()=>{let n,r=p("CLS",0);const o=S(e,W),a=d=>{for(const c of d)o.h(c);o.i>r.value&&(r.value=o.i,r.entries=o.o,n())},s=v("layout-shift",a);s&&(n=h(t,r,k,e.reportAllChanges),i.onHidden(()=>{a(s.takeRecords()),n(!0)}),f(()=>{o.i=0,r=p("CLS",0),n=h(t,r,k,e.reportAllChanges),E(()=>n())}),setTimeout(n))}))};let D=0,C=1/0,g=0;const z=t=>{for(const e of t)e.interactionId&&(C=Math.min(C,e.interactionId),g=Math.max(g,e.interactionId),D=g?(g-C)/7+1:0)};let L;const F=()=>L?D:performance.interactionCount??0,G=()=>{"interactionCount"in performance||L||(L=v("event",z,{type:"event",buffered:!0,durationThreshold:0}))};let H=0;class J{constructor(){u(this,"u",[]);u(this,"l",new Map);u(this,"m");u(this,"p")}v(){H=F(),this.u.length=0,this.l.clear()}L(){const e=Math.min(this.u.length-1,Math.floor((F()-H)/50));return this.u[e]}h(e){var r,o;if((r=this.m)==null||r.call(this,e),!e.interactionId&&e.entryType!=="first-input")return;const i=this.u.at(-1);let n=this.l.get(e.interactionId);if(n||this.u.length<10||e.duration>i.P){if(n?e.duration>n.P?(n.entries=[e],n.P=e.duration):e.duration===n.P&&e.startTime===n.entries[0].startTime&&n.entries.push(e):(n={id:e.interactionId,entries:[e],P:e.duration},this.l.set(n.id,n),this.u.push(n)),this.u.sort((a,s)=>s.P-a.P),this.u.length>10){const a=this.u.splice(10);for(const s of a)this.l.delete(s.id)}(o=this.p)==null||o.call(this,n)}}}const O=t=>{const e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?t():(t=w(t),addEventListener("visibilitychange",t,{once:!0,capture:!0}),e(()=>{t(),removeEventListener("visibilitychange",t,{capture:!0})}))},x=[200,500],V=(t,e={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;const i=y();I(()=>{G();let n,r=p("INP");const o=S(e,J),a=d=>{O(()=>{for(const l of d)o.h(l);const c=o.L();c&&c.P!==r.value&&(r.value=c.P,r.entries=c.entries,n())})},s=v("event",a,{durationThreshold:e.durationThreshold??40});n=h(t,r,x,e.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),i.onHidden(()=>{a(s.takeRecords()),n(!0)}),f(()=>{o.v(),r=p("INP"),n=h(t,r,x,e.reportAllChanges)}))})};class K{constructor(){u(this,"m")}h(e){var i;(i=this.m)==null||i.call(this,e)}}const N=[2500,4e3],X=(t,e={})=>{I(()=>{const i=y();let n,r=p("LCP");const o=S(e,K),a=d=>{e.reportAllChanges||(d=d.slice(-1));for(const c of d)o.h(c),c.startTime<i.firstHiddenTime&&(r.value=Math.max(c.startTime-T(),0),r.entries=[c],n())},s=v("largest-contentful-paint",a);if(s){n=h(t,r,N,e.reportAllChanges);const d=w(()=>{a(s.takeRecords()),s.disconnect(),n(!0)}),c=l=>{l.isTrusted&&(O(d),removeEventListener(l.type,c,{capture:!0}))};for(const l of["keydown","click","visibilitychange"])addEventListener(l,c,{capture:!0});f(l=>{r=p("LCP"),n=h(t,r,N,e.reportAllChanges),E(()=>{r.value=performance.now()-l.timeStamp,n(!0)})})}})};export{k as CLSThresholds,M as FCPThresholds,x as INPThresholds,N as LCPThresholds,U as onCLS,j as onFCP,V as onINP,X as onLCP};
